<html>
<head>
	<title>1717 Attendance</title>
	<style>
		* { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }
		body {
			padding: 0;
			margin: 0;
			font-family: "Century Gothic";
		}

		h1 {
			font-size: 80px;
			padding: 0;
			margin: 0;
			text-align: center;
			font-weight: normal;
		}

		h3 {
			text-align: center;
			padding: 0;
			margin: 10px;
			font-weight: normal;
		}

		.grey {
			opacity: .4;
		}

		.students_container {
			width: 100%;
			background: #eee;

			border-top: 1px solid #ccc;

			padding-bottom: 20px;

			-webkit-touch-callout: none;
			-webkit-user-select: none;
			-khtml-user-select: none;
			-moz-user-select: none;
			-ms-user-select: none;
			user-select: none;
		}

		.students_container > .student {
			
			display: inline-block;
			background: #fff;
			margin: 19px 0 0 19px ;
			padding: 1.3em;

			text-align: center;
			font-size: 28px;

			box-shadow: 0 0 2px 2px #bbb;

		}




		.search {
			position: relative;
			width: 100%;
			height: 50px;
			background: yellow;
			font-size: 24px;

		}

		.search input {
			position: absolute;
			font-size: inherit;
			font-family: "Century Gothic";
			outline: none;
			height: inherit;
			width: inherit;
			padding: 10px;
			
		}

		.search p.overlay {
			position: absolute;
			font-size: inherit;
			margin: 0px;
			top: 10px;
			left: 11px;
			width: 100%;
			opacity: .5;

		}

	</style>
</head>
<body>
	<h1><b>1717</b> Attendance</h1>
	<h3>
		<b>Students Present:&nbsp;</b><span class="head_count">0</span>
	</h3>

	<div class="search" id="search">
		<input type="text" />
		<p class="overlay"></p>
	</div>

	<div class="students_container">
		<!-- students to get inserted here pragmatically from names.js-->
	</div>
</body>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script src="names.js"></script>
<script>

	Array.prototype.partialMatch = function(partial) {
		for(var i = 0; i < this.length; i++) {
			if (this[i].toLowerCase().search(partial.toLowerCase()) == 0) {
				return this[i];	
			}
		}
	}


	var head_count = 0;
	var student_html = [];

	function checkStudentOff(student_element) {
		var $student_element = $(student_element);

		if($student_element.hasClass("grey"))
			return;
		
		if ($student_element.is(":last-child")) {
			$student_element.addClass("grey");
		} else {
			$student_element.insertAfter(".students_container > .student:last-child")
					 		.addClass("grey");
		}

		$("h3 .head_count").text(++head_count);
	}

	function uncheckOffStudent(student_element) {
		var $student_element = $(student_element);
		
		if ($student_element.is(":first-child")) {
			$student_element.removeClass("grey");
		} else {
			$student_element.insertBefore(".students_container > .student:first-child")
					 		.removeClass("grey");
		}

		$("h3 .head_count").text(--head_count);
	}


	//autocomplete logic...
	$(".search input").focus(function() {
		$(this).keyup(function(e) {

			var match = student_names.partialMatch(this.value);

			//if enter key, remove the person
			if(e.keyCode === 13) {
				$.each($(".student"), function() {
					if($(this).text() === match) {
						checkStudentOff(this);

						//clear the field
						$(".search p.overlay").text("");
						$(".search input").val("");

						return;
					}
				});
			}

			//makes sure the field isn't empty and there is a match
			if(this.value != "" && match) {

				//update the input box with autocomplete
				$(".search p.overlay").text(match.toLowerCase());

			} 
			//if there's nothing, clear the field
			else {
				$(".search p.overlay").text("");
			}
		});
	});

	

	//generate student names p tag
	$.each(student_names, function() {
		student_html.push(
			$("<p>", {class: "student", text: this})
		);
	});

	//insert the block
	$(".students_container").append(student_html);

	//Listen for click
	$(".student").click(function(e) {

		if($(e.target).hasClass("grey")) {
			uncheckOffStudent(e.target)
		} else {
			checkStudentOff(e.target);
		}
	})

</script>

</html>